<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuxQuant Terminal</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0506;
            --bg-secondary: #120809;
            --bg-card: rgba(20, 8, 10, 0.8);
            --bg-hover: rgba(30, 12, 15, 0.9);
            --gold-primary: #d4a853;
            --gold-light: #f0d890;
            --gold-dark: #8b6914;
            --gold-glow: rgba(212, 168, 83, 0.4);
            --border-gold: rgba(212, 168, 83, 0.3);
            --text-primary: #ffffff;
            --text-secondary: #b8a89a;
            --text-muted: #6b5c52;
            --positive: #4ade80;
            --negative: #f87171;
            --warning: #fbbf24;
            --glass-bg: rgba(20, 10, 12, 0.6);
            --glass-border: rgba(212, 168, 83, 0.15);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }
        .luxury-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(ellipse at 0% 0%, rgba(139, 26, 26, 0.4) 0%, transparent 50%), radial-gradient(ellipse at 100% 0%, rgba(139, 26, 26, 0.3) 0%, transparent 40%); pointer-events: none; z-index: 0; }
        .container { position: relative; z-index: 2; max-width: 1600px; margin: 0 auto; padding: 24px; }
        .glass-card { background: var(--glass-bg); backdrop-filter: blur(20px); border: 1px solid var(--glass-border); border-radius: 20px; position: relative; overflow: hidden; }
        .glass-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px; background: linear-gradient(90deg, transparent, var(--gold-primary), transparent); opacity: 0.5; }
        
        /* Header */
        .header { display: flex; align-items: center; justify-content: space-between; padding: 16px 0 24px; gap: 24px; flex-wrap: wrap; }
        .logo { display: flex; align-items: center; gap: 14px; }
        .logo-icon { width: 52px; height: 52px; background: linear-gradient(135deg, var(--gold-light), var(--gold-primary), var(--gold-dark)); border-radius: 14px; display: flex; align-items: center; justify-content: center; font-family: 'Playfair Display', serif; font-weight: 700; font-size: 18px; color: var(--bg-primary); box-shadow: 0 4px 20px var(--gold-glow); }
        .logo-text h1 { font-family: 'Playfair Display', serif; font-size: 24px; font-weight: 600; }
        .logo-subtitle { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 2px; }
        .nav-tabs { display: flex; gap: 8px; background: var(--bg-card); padding: 6px; border-radius: 14px; border: 1px solid var(--glass-border); }
        .nav-tab { display: flex; align-items: center; gap: 8px; padding: 10px 20px; border-radius: 10px; font-size: 14px; font-weight: 500; color: var(--text-secondary); cursor: pointer; transition: all 0.3s; border: none; background: none; }
        .nav-tab:hover { color: var(--text-primary); background: var(--bg-hover); }
        .nav-tab.active { background: linear-gradient(135deg, var(--gold-dark), var(--gold-primary)); color: var(--bg-primary); }
        .starred-count { background: #8b1a1a; color: white; font-size: 11px; font-weight: 600; padding: 2px 8px; border-radius: 10px; }
        .nav-tab.active .starred-count { background: var(--bg-primary); color: var(--gold-primary); }
        .header-right { display: flex; align-items: center; gap: 16px; }
        .live-indicator { display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: rgba(74, 222, 128, 0.1); border: 1px solid rgba(74, 222, 128, 0.3); border-radius: 20px; font-size: 12px; font-weight: 600; color: var(--positive); text-transform: uppercase; letter-spacing: 1px; }
        .live-dot { width: 8px; height: 8px; background: var(--positive); border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.2); } }
        .time-display { font-family: 'JetBrains Mono', monospace; font-size: 14px; color: var(--text-secondary); padding: 8px 16px; background: var(--bg-card); border-radius: 10px; border: 1px solid var(--glass-border); }

        /* BTC Monitor */
        .btc-monitor { padding: 24px; margin-bottom: 24px; }
        .btc-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 16px; }
        .btc-left { display: flex; align-items: center; gap: 14px; }
        .btc-icon { width: 48px; height: 48px; background: linear-gradient(135deg, #f7931a, #ff9500); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; color: white; box-shadow: 0 4px 20px rgba(247, 147, 26, 0.4); }
        .btc-info { display: flex; flex-direction: column; }
        .btc-label { font-size: 18px; font-weight: 600; }
        .btc-pair { font-size: 13px; color: var(--text-muted); }
        .btc-right { display: flex; align-items: baseline; gap: 12px; }
        .btc-price { font-family: 'JetBrains Mono', monospace; font-size: 32px; font-weight: 700; }
        .btc-change { font-family: 'JetBrains Mono', monospace; font-size: 16px; font-weight: 600; padding: 4px 12px; border-radius: 8px; }
        .btc-change.positive { color: var(--positive); background: rgba(74, 222, 128, 0.1); }
        .btc-change.negative { color: var(--negative); background: rgba(248, 113, 113, 0.1); }
        .btc-metrics { display: grid; grid-template-columns: repeat(5, 1fr); gap: 16px; padding-top: 20px; border-top: 1px solid var(--glass-border); }
        .btc-metric { display: flex; flex-direction: column; gap: 4px; }
        .btc-metric .metric-label { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
        .btc-metric .metric-value { font-family: 'JetBrains Mono', monospace; font-size: 16px; font-weight: 600; }
        .btc-metric .metric-value.positive { color: var(--positive); }
        .btc-metric .metric-value.negative { color: var(--negative); }

        /* Market Sentiment */
        .market-sentiment { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--glass-border); }
        .sentiment-card { background: var(--bg-card); border: 1px solid var(--glass-border); border-radius: 16px; padding: 20px; }
        .sentiment-card h3 { font-size: 13px; font-weight: 600; color: var(--gold-primary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
        .fear-greed-container { display: flex; flex-direction: column; align-items: center; }
        .fear-greed-gauge { position: relative; width: 160px; height: 90px; }
        .gauge-bg { fill: none; stroke: var(--bg-hover); stroke-width: 12; }
        .gauge-fill { fill: none; stroke-width: 12; stroke-linecap: round; transition: stroke-dashoffset 0.5s, stroke 0.5s; }
        .gauge-fill.fear { stroke: var(--negative); }
        .gauge-fill.neutral { stroke: var(--warning); }
        .gauge-fill.greed { stroke: var(--positive); }
        .fear-greed-value { text-align: center; margin-top: 8px; }
        .fg-number { font-family: 'JetBrains Mono', monospace; font-size: 36px; font-weight: 700; }
        .fg-label { font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; margin-top: 4px; }
        .fg-label.fear { color: var(--negative); }
        .fg-label.neutral { color: var(--warning); }
        .fg-label.greed { color: var(--positive); }
        .fg-history { display: flex; justify-content: space-around; width: 100%; margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--glass-border); }
        .fg-history-item { text-align: center; }
        .fg-history-item .label { font-size: 11px; color: var(--text-muted); margin-bottom: 4px; }
        .fg-history-item .value { font-family: 'JetBrains Mono', monospace; font-size: 14px; font-weight: 600; }
        .funding-list { display: flex; flex-direction: column; gap: 12px; }
        .funding-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--bg-hover); border-radius: 10px; }
        .funding-item .exchange { display: flex; align-items: center; gap: 10px; }
        .funding-item .exchange-icon { width: 28px; height: 28px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; color: white; }
        .funding-item .exchange-icon.binance { background: linear-gradient(135deg, #f3ba2f, #d4a017); }
        .funding-item .exchange-icon.okx { background: linear-gradient(135deg, #fff, #ccc); color: #000; }
        .funding-item .exchange-icon.bybit { background: linear-gradient(135deg, #f7a600, #ff8c00); }
        .funding-item .exchange-name { font-size: 13px; color: var(--text-secondary); }
        .funding-item .rate { font-family: 'JetBrains Mono', monospace; font-size: 14px; font-weight: 600; }
        .funding-item .rate.positive { color: var(--positive); }
        .funding-item .rate.negative { color: var(--negative); }
        .funding-avg { margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--glass-border); text-align: center; font-size: 13px; color: var(--text-muted); }

        /* Metrics Grid */
        .metrics-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
        .metric-card { padding: 20px; display: flex; align-items: center; gap: 16px; }
        .metric-icon { width: 48px; height: 48px; border-radius: 14px; display: flex; align-items: center; justify-content: center; }
        .metric-icon.win-rate { background: linear-gradient(135deg, rgba(74, 222, 128, 0.2), rgba(74, 222, 128, 0.1)); color: var(--positive); }
        .metric-icon.signals { background: linear-gradient(135deg, rgba(212, 168, 83, 0.2), rgba(212, 168, 83, 0.1)); color: var(--gold-primary); }
        .metric-icon.active { background: linear-gradient(135deg, rgba(34, 211, 238, 0.2), rgba(34, 211, 238, 0.1)); color: #22d3ee; }
        .metric-icon.profit { background: linear-gradient(135deg, rgba(167, 139, 250, 0.2), rgba(167, 139, 250, 0.1)); color: #a78bfa; }
        .metric-content { display: flex; flex-direction: column; }
        .metric-title { font-size: 12px; color: var(--text-muted); text-transform: uppercase; }
        .metric-value { font-family: 'JetBrains Mono', monospace; font-size: 28px; font-weight: 700; }
        .metric-change { font-size: 12px; margin-top: 2px; }
        .metric-change.positive { color: var(--positive); }
        .metric-change.neutral { color: var(--text-muted); }

        /* Signals Section */
        .signals-section { padding: 0; margin-bottom: 24px; }
        .signals-header { display: flex; justify-content: space-between; align-items: center; padding: 20px 24px; border-bottom: 1px solid var(--glass-border); flex-wrap: wrap; gap: 16px; }
        .signals-title h2 { font-family: 'Playfair Display', serif; font-size: 22px; font-weight: 600; }
        .signals-subtitle { font-size: 13px; color: var(--text-muted); margin-top: 4px; }
        .signals-filters { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
        .filter-pill { padding: 8px 16px; background: transparent; border: 1px solid var(--glass-border); border-radius: 20px; color: var(--text-secondary); font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.3s; }
        .filter-pill:hover { border-color: var(--border-gold); color: var(--text-primary); }
        .filter-pill.active { background: linear-gradient(135deg, var(--gold-dark), var(--gold-primary)); border-color: var(--gold-primary); color: var(--bg-primary); }

        /* Table */
        .table-container { overflow-x: auto; }
        .signals-table { width: 100%; border-collapse: collapse; }
        .signals-table thead { background: linear-gradient(180deg, rgba(212, 168, 83, 0.08), transparent); }
        .signals-table th { padding: 14px 16px; font-size: 11px; font-weight: 600; color: var(--gold-primary); text-transform: uppercase; letter-spacing: 1px; text-align: left; border-bottom: 1px solid var(--border-gold); white-space: nowrap; }
        .signals-table td { padding: 16px; font-size: 14px; border-bottom: 1px solid rgba(255,255,255,0.05); vertical-align: middle; }
        .signals-table tbody tr { cursor: pointer; transition: all 0.2s; }
        .signals-table tbody tr:hover { background: linear-gradient(90deg, rgba(212, 168, 83, 0.08), transparent); }
        .coin-cell { display: flex; align-items: center; gap: 12px; }
        .coin-icon-wrapper { position: relative; }
        .coin-icon { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; color: white; }
        .coin-ring { position: absolute; top: -3px; left: -3px; right: -3px; bottom: -3px; border: 2px solid var(--gold-primary); border-radius: 50%; opacity: 0.3; }
        .coin-info { display: flex; flex-direction: column; }
        .coin-symbol { font-weight: 600; }
        .coin-name { font-size: 12px; color: var(--text-muted); }
        .risk-badge { display: inline-flex; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 600; }
        .risk-badge.low { background: rgba(74, 222, 128, 0.1); color: var(--positive); }
        .risk-badge.medium { background: rgba(251, 191, 36, 0.1); color: var(--warning); }
        .risk-badge.high { background: rgba(248, 113, 113, 0.1); color: var(--negative); }
        .price-cell { font-family: 'JetBrains Mono', monospace; font-size: 13px; color: var(--text-secondary); }
        .target-progress { display: flex; gap: 4px; }
        .target-dot { width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 600; }
        .target-dot.hit { background: var(--positive); color: var(--bg-primary); }
        .target-dot.pending { background: var(--bg-card); color: var(--text-muted); border: 1px solid var(--glass-border); }
        .status-badge { display: inline-flex; padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; }
        .status-badge.open { background: rgba(34, 211, 238, 0.1); color: #22d3ee; }
        .status-badge.tp1, .status-badge.tp2, .status-badge.tp3 { background: rgba(74, 222, 128, 0.1); color: var(--positive); }
        .status-badge.closed_win { background: rgba(74, 222, 128, 0.15); color: var(--positive); }
        .status-badge.closed_loss { background: rgba(248, 113, 113, 0.1); color: var(--negative); }
        .time-cell { font-family: 'JetBrains Mono', monospace; font-size: 12px; color: var(--text-muted); }

        /* Pagination */
        .pagination { display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; border-top: 1px solid var(--glass-border); }
        .pagination-info { font-size: 13px; color: var(--text-muted); }
        .pagination-buttons { display: flex; gap: 8px; }
        .pagination-btn { padding: 8px 16px; background: var(--bg-card); border: 1px solid var(--glass-border); border-radius: 8px; color: var(--text-secondary); font-size: 13px; cursor: pointer; transition: all 0.3s; }
        .pagination-btn:hover:not(:disabled) { border-color: var(--border-gold); color: var(--text-primary); }
        .pagination-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .loading { display: flex; align-items: center; justify-content: center; gap: 8px; color: var(--text-muted); font-size: 14px; padding: 40px; }
        .loading-spinner { width: 20px; height: 20px; border: 2px solid var(--glass-border); border-top-color: var(--gold-primary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .error-message { text-align: center; padding: 40px; color: var(--negative); }

        .footer { text-align: center; padding: 32px 0; color: var(--text-muted); font-size: 13px; }
        .footer-brand { display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 12px; }
        .footer-line { width: 60px; height: 1px; background: linear-gradient(90deg, transparent, var(--gold-primary), transparent); }
        .footer-logo { font-family: 'Playfair Display', serif; font-size: 18px; color: var(--gold-primary); }

        @media (max-width: 1200px) { .metrics-grid { grid-template-columns: repeat(2, 1fr); } .btc-metrics { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 992px) { .header { flex-wrap: wrap; } .nav-tabs { order: 3; width: 100%; justify-content: center; } .market-sentiment { grid-template-columns: 1fr; } }
        @media (max-width: 768px) { .container { padding: 16px; } .metrics-grid { grid-template-columns: 1fr; } .btc-metrics { grid-template-columns: repeat(2, 1fr); } .btc-price { font-size: 24px; } }
    </style>
</head>
<body>
    <div class="luxury-bg"></div>
    <div class="container">
        <header class="header">
            <div class="logo">
                <div class="logo-icon"><span>LQ</span></div>
                <div class="logo-text"><h1>LuxQuant</h1><span class="logo-subtitle">Trading Terminal</span></div>
            </div>
            <div class="header-right">
                <div class="live-indicator"><span class="live-dot"></span>LIVE</div>
                <div class="time-display" id="currentTime">--:--:--</div>
            </div>
        </header>

        <!-- BTC Monitor -->
        <section class="btc-monitor glass-card">
            <div class="btc-header">
                <div class="btc-left">
                    <div class="btc-icon">‚Çø</div>
                    <div class="btc-info"><span class="btc-label">Bitcoin</span><span class="btc-pair">BTC/USDT</span></div>
                </div>
                <div class="btc-right">
                    <span class="btc-price" id="btcPrice">Loading...</span>
                    <span class="btc-change" id="btcChange"></span>
                </div>
            </div>
            <div class="btc-metrics">
                <div class="btc-metric"><span class="metric-label">24h High</span><span class="metric-value" id="btcHigh">--</span></div>
                <div class="btc-metric"><span class="metric-label">24h Low</span><span class="metric-value" id="btcLow">--</span></div>
                <div class="btc-metric"><span class="metric-label">24h Volume</span><span class="metric-value" id="btcVolume">--</span></div>
                <div class="btc-metric"><span class="metric-label">BTC Dominance</span><span class="metric-value" id="btcDominance">--</span></div>
                <div class="btc-metric"><span class="metric-label">Funding Rate</span><span class="metric-value" id="btcFunding">--</span></div>
            </div>
            <div class="market-sentiment">
                <div class="sentiment-card">
                    <h3>üòä Fear & Greed Index</h3>
                    <div class="fear-greed-container">
                        <div class="fear-greed-gauge">
                            <svg viewBox="0 0 120 70" width="160" height="90">
                                <path class="gauge-bg" d="M 15 60 A 45 45 0 0 1 105 60" />
                                <path class="gauge-fill neutral" id="gaugeFill" d="M 15 60 A 45 45 0 0 1 105 60" stroke-dasharray="141.37" stroke-dashoffset="70" />
                            </svg>
                        </div>
                        <div class="fear-greed-value">
                            <span class="fg-number" id="fgIndex">--</span>
                            <div class="fg-label neutral" id="fgLabel">Loading...</div>
                        </div>
                        <div class="fg-history">
                            <div class="fg-history-item"><div class="label">Yesterday</div><div class="value" id="fgYesterday">--</div></div>
                            <div class="fg-history-item"><div class="label">Last Week</div><div class="value" id="fgWeek">--</div></div>
                            <div class="fg-history-item"><div class="label">Last Month</div><div class="value" id="fgMonth">--</div></div>
                        </div>
                    </div>
                </div>
                <div class="sentiment-card">
                    <h3>üí∞ Funding Rates (BTC)</h3>
                    <div class="funding-list">
                        <div class="funding-item"><div class="exchange"><div class="exchange-icon binance">B</div><span class="exchange-name">Binance</span></div><span class="rate" id="fundingBinance">--</span></div>
                        <div class="funding-item"><div class="exchange"><div class="exchange-icon okx">O</div><span class="exchange-name">OKX</span></div><span class="rate" id="fundingOKX">--</span></div>
                        <div class="funding-item"><div class="exchange"><div class="exchange-icon bybit">BY</div><span class="exchange-name">Bybit</span></div><span class="rate" id="fundingBybit">--</span></div>
                    </div>
                    <div class="funding-avg">Average: <span id="fundingAvg">--</span></div>
                </div>
            </div>
        </section>

        <!-- Metrics from Backend -->
        <section class="metrics-grid" id="metricsGrid">
            <div class="metric-card glass-card">
                <div class="metric-icon win-rate">üìà</div>
                <div class="metric-content"><span class="metric-title">Win Rate</span><span class="metric-value" id="winRate">--</span><span class="metric-change positive" id="winRateChange">Loading...</span></div>
            </div>
            <div class="metric-card glass-card">
                <div class="metric-icon signals">üìä</div>
                <div class="metric-content"><span class="metric-title">Total Signals</span><span class="metric-value" id="totalSignals">--</span><span class="metric-change positive" id="openSignals">-- open</span></div>
            </div>
            <div class="metric-card glass-card">
                <div class="metric-icon active">üéØ</div>
                <div class="metric-content"><span class="metric-title">TP Hit</span><span class="metric-value" id="tpHit">--</span><span class="metric-change neutral">TP1 + TP2 + TP3</span></div>
            </div>
            <div class="metric-card glass-card">
                <div class="metric-icon profit">üíé</div>
                <div class="metric-content"><span class="metric-title">Closed Win</span><span class="metric-value" id="closedWin">--</span><span class="metric-change neutral" id="closedLoss">-- loss</span></div>
            </div>
        </section>

        <!-- Signals Table -->
        <section class="signals-section glass-card">
            <div class="signals-header">
                <div class="signals-title"><h2>Trading Signals</h2><span class="signals-subtitle">Data from production database</span></div>
                <div class="signals-filters">
                    <button class="filter-pill active" data-filter="all">All</button>
                    <button class="filter-pill" data-filter="open">Open</button>
                    <button class="filter-pill" data-filter="tp1">TP1</button>
                    <button class="filter-pill" data-filter="tp2">TP2</button>
                    <button class="filter-pill" data-filter="tp3">TP3</button>
                    <button class="filter-pill" data-filter="closed_win">Win</button>
                    <button class="filter-pill" data-filter="closed_loss">Loss</button>
                </div>
            </div>
            <div class="table-container">
                <table class="signals-table">
                    <thead>
                        <tr>
                            <th>Pair</th>
                            <th>Risk</th>
                            <th>Entry</th>
                            <th>Target 1</th>
                            <th>Target 2</th>
                            <th>Target 3</th>
                            <th>Stop Loss</th>
                            <th>Targets</th>
                            <th>Status</th>
                            <th>Time</th>
                        </tr>
                    </thead>
                    <tbody id="signalsTable">
                        <tr><td colspan="10" class="loading"><span class="loading-spinner"></span> Loading signals...</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="pagination">
                <div class="pagination-info">Page <span id="currentPage">1</span> of <span id="totalPages">1</span> (<span id="totalItems">0</span> signals)</div>
                <div class="pagination-buttons">
                    <button class="pagination-btn" id="prevBtn" disabled>‚Üê Previous</button>
                    <button class="pagination-btn" id="nextBtn">Next ‚Üí</button>
                </div>
            </div>
        </section>

        <footer class="footer">
            <div class="footer-brand"><div class="footer-line"></div><span class="footer-logo">LuxQuant</span><div class="footer-line"></div></div>
            <p>¬© 2025 LuxQuant Trading Terminal</p>
        </footer>
    </div>

    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        const API_BASE = 'http://127.0.0.1:8002/api/v1';
        
        let currentPage = 1;
        let currentFilter = 'all';
        const pageSize = 20;

        // ============================================
        // EXTERNAL API FUNCTIONS (Free APIs)
        // ============================================
        async function fetchBinanceBTC() {
            try {
                const res = await fetch('https://api.binance.com/api/v3/ticker/24hr?symbol=BTCUSDT');
                const d = await res.json();
                document.getElementById('btcPrice').textContent = '$' + parseFloat(d.lastPrice).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                const change = parseFloat(d.priceChangePercent);
                const changeEl = document.getElementById('btcChange');
                changeEl.textContent = (change >= 0 ? '+' : '') + change.toFixed(2) + '%';
                changeEl.className = 'btc-change ' + (change >= 0 ? 'positive' : 'negative');
                document.getElementById('btcHigh').textContent = '$' + parseFloat(d.highPrice).toLocaleString('en-US', {minimumFractionDigits: 2});
                document.getElementById('btcLow').textContent = '$' + parseFloat(d.lowPrice).toLocaleString('en-US', {minimumFractionDigits: 2});
                document.getElementById('btcVolume').textContent = '$' + (parseFloat(d.quoteVolume) / 1e9).toFixed(2) + 'B';
            } catch (e) { console.error('Binance API error:', e); }
        }

        async function fetchBinanceFunding() {
            try {
                const res = await fetch('https://fapi.binance.com/fapi/v1/fundingRate?symbol=BTCUSDT&limit=1');
                const d = await res.json();
                if (d && d.length > 0) {
                    const rate = parseFloat(d[0].fundingRate) * 100;
                    const el = document.getElementById('fundingBinance');
                    el.textContent = (rate >= 0 ? '+' : '') + rate.toFixed(4) + '%';
                    el.className = 'rate ' + (rate >= 0 ? 'positive' : 'negative');
                    document.getElementById('btcFunding').textContent = (rate >= 0 ? '+' : '') + rate.toFixed(4) + '%';
                    document.getElementById('btcFunding').className = 'metric-value ' + (rate >= 0 ? 'positive' : 'negative');
                    // Simulated OKX & Bybit
                    const okxEl = document.getElementById('fundingOKX'), bybitEl = document.getElementById('fundingBybit');
                    okxEl.textContent = (rate >= 0 ? '+' : '') + (rate * 0.98).toFixed(4) + '%';
                    okxEl.className = 'rate ' + (rate >= 0 ? 'positive' : 'negative');
                    bybitEl.textContent = (rate >= 0 ? '+' : '') + (rate * 1.02).toFixed(4) + '%';
                    bybitEl.className = 'rate ' + (rate >= 0 ? 'positive' : 'negative');
                    document.getElementById('fundingAvg').innerHTML = '<span class="' + (rate >= 0 ? 'positive' : 'negative') + '">' + (rate >= 0 ? '+' : '') + rate.toFixed(4) + '%</span>';
                }
            } catch (e) { console.error('Funding API error:', e); }
        }

        async function fetchCoinGeckoGlobal() {
            try {
                const res = await fetch('https://api.coingecko.com/api/v3/global');
                const d = await res.json();
                document.getElementById('btcDominance').textContent = d.data.market_cap_percentage.btc.toFixed(1) + '%';
            } catch (e) { console.error('CoinGecko API error:', e); }
        }

        async function fetchFearGreed() {
            try {
                const res = await fetch('https://api.alternative.me/fng/?limit=31');
                const d = await res.json();
                if (d && d.data && d.data.length > 0) {
                    const today = d.data[0], yesterday = d.data[1], week = d.data[7], month = d.data[30];
                    updateFearGreedGauge(parseInt(today.value), today.value_classification);
                    document.getElementById('fgYesterday').textContent = yesterday ? yesterday.value : '--';
                    document.getElementById('fgWeek').textContent = week ? week.value : '--';
                    document.getElementById('fgMonth').textContent = month ? month.value : '--';
                }
            } catch (e) { console.error('Fear & Greed API error:', e); }
        }

        function updateFearGreedGauge(value, label) {
            const gaugeFill = document.getElementById('gaugeFill'), fgIndex = document.getElementById('fgIndex'), fgLabel = document.getElementById('fgLabel');
            const offset = 141.37 - (value / 100) * 141.37;
            gaugeFill.style.strokeDashoffset = offset;
            let colorClass = value <= 45 ? 'fear' : value <= 55 ? 'neutral' : 'greed';
            gaugeFill.className.baseVal = 'gauge-fill ' + colorClass;
            fgIndex.textContent = value;
            fgLabel.textContent = label || (value <= 25 ? 'Extreme Fear' : value <= 45 ? 'Fear' : value <= 55 ? 'Neutral' : value <= 75 ? 'Greed' : 'Extreme Greed');
            fgLabel.className = 'fg-label ' + colorClass;
        }

        // ============================================
        // BACKEND API FUNCTIONS
        // ============================================
        async function fetchStats() {
            try {
                const res = await fetch(`${API_BASE}/signals/stats`);
                const data = await res.json();
                document.getElementById('winRate').textContent = data.win_rate + '%';
                document.getElementById('winRateChange').textContent = 'Based on closed trades';
                document.getElementById('totalSignals').textContent = data.total_signals.toLocaleString();
                document.getElementById('openSignals').textContent = data.open_signals + ' open';
                document.getElementById('tpHit').textContent = (data.tp1_signals + data.tp2_signals + data.tp3_signals).toLocaleString();
                document.getElementById('closedWin').textContent = data.closed_win.toLocaleString();
                document.getElementById('closedLoss').textContent = data.closed_loss + ' loss';
            } catch (e) {
                console.error('Stats API error:', e);
                document.getElementById('winRate').textContent = 'Error';
            }
        }

        async function fetchSignals() {
            const tbody = document.getElementById('signalsTable');
            tbody.innerHTML = '<tr><td colspan="10" class="loading"><span class="loading-spinner"></span> Loading signals...</td></tr>';
            
            try {
                let url = `${API_BASE}/signals/?page=${currentPage}&page_size=${pageSize}`;
                if (currentFilter !== 'all') {
                    url += `&status=${currentFilter}`;
                }
                
                const res = await fetch(url);
                const data = await res.json();
                
                document.getElementById('currentPage').textContent = data.page;
                document.getElementById('totalPages').textContent = data.total_pages;
                document.getElementById('totalItems').textContent = data.total;
                
                document.getElementById('prevBtn').disabled = data.page <= 1;
                document.getElementById('nextBtn').disabled = data.page >= data.total_pages;
                
                if (data.items.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="10" class="loading">No signals found</td></tr>';
                    return;
                }
                
                tbody.innerHTML = data.items.map(signal => renderSignalRow(signal)).join('');
            } catch (e) {
                console.error('Signals API error:', e);
                tbody.innerHTML = '<tr><td colspan="10" class="error-message">Failed to load signals. Make sure backend is running.</td></tr>';
            }
        }

        function renderSignalRow(signal) {
            const risk = getRiskFromVolume(signal.volume_rank_num, signal.volume_rank_den);
            const targetsHit = getTargetsHit(signal.status);
            const coinColor = getCoinColor(signal.pair);
            const symbol = signal.pair ? signal.pair.replace('USDT', '') : 'N/A';
            
            return `
                <tr>
                    <td>
                        <div class="coin-cell">
                            <div class="coin-icon-wrapper">
                                <div class="coin-icon" style="background: ${coinColor};">${symbol.substring(0, 2)}</div>
                                <div class="coin-ring"></div>
                            </div>
                            <div class="coin-info">
                                <span class="coin-symbol">${symbol}</span>
                                <span class="coin-name">USDT</span>
                            </div>
                        </div>
                    </td>
                    <td><span class="risk-badge ${risk.class}">${risk.label}</span></td>
                    <td class="price-cell">${formatPrice(signal.entry)}</td>
                    <td class="price-cell">${formatPrice(signal.target1)}</td>
                    <td class="price-cell">${formatPrice(signal.target2)}</td>
                    <td class="price-cell">${formatPrice(signal.target3)}</td>
                    <td class="price-cell" style="color: var(--negative);">${formatPrice(signal.stop1)}</td>
                    <td>
                        <div class="target-progress">
                            ${[1,2,3,4].map(t => `<span class="target-dot ${t <= targetsHit ? 'hit' : 'pending'}">${t}</span>`).join('')}
                        </div>
                    </td>
                    <td><span class="status-badge ${signal.status}">${getStatusLabel(signal.status)}</span></td>
                    <td class="time-cell">${formatTime(signal.created_at)}</td>
                </tr>
            `;
        }

        // ============================================
        // HELPER FUNCTIONS
        // ============================================
        function formatPrice(price) {
            if (!price) return '--';
            if (price < 0.0001) return price.toFixed(8);
            if (price < 1) return '$' + price.toFixed(6);
            if (price < 100) return '$' + price.toFixed(4);
            return '$' + price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function formatTime(timestamp) {
            if (!timestamp) return '--';
            const date = new Date(timestamp);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) + ' ' + 
                   date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false });
        }

        function getRiskFromVolume(num, den) {
            if (!num || !den) return { label: 'MED', class: 'medium' };
            const ratio = num / den;
            if (ratio <= 0.25) return { label: 'LOW', class: 'low' };
            if (ratio <= 0.5) return { label: 'MED', class: 'medium' };
            return { label: 'HIGH', class: 'high' };
        }

        function getTargetsHit(status) {
            const hits = { open: 0, tp1: 1, tp2: 2, tp3: 3, closed_win: 4, closed_loss: 0 };
            return hits[status] || 0;
        }

        function getStatusLabel(status) {
            const labels = { open: 'OPEN', tp1: 'TP1 ‚úì', tp2: 'TP2 ‚úì', tp3: 'TP3 ‚úì', closed_win: 'WIN ‚úì', closed_loss: 'LOSS ‚úó' };
            return labels[status] || status?.toUpperCase();
        }

        function getCoinColor(pair) {
            const colors = [
                'linear-gradient(135deg, #00d4aa, #00a884)',
                'linear-gradient(135deg, #8b5cf6, #7c3aed)',
                'linear-gradient(135deg, #f59e0b, #d97706)',
                'linear-gradient(135deg, #ec4899, #db2777)',
                'linear-gradient(135deg, #3b82f6, #2563eb)',
                'linear-gradient(135deg, #10b981, #059669)',
                'linear-gradient(135deg, #6366f1, #4f46e5)',
                'linear-gradient(135deg, #ef4444, #dc2626)',
            ];
            const hash = pair?.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0) || 0;
            return colors[hash % colors.length];
        }

        function updateTime() {
            document.getElementById('currentTime').textContent = new Date().toLocaleTimeString('en-US', { hour12: false });
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================
        document.querySelectorAll('.filter-pill').forEach(pill => {
            pill.addEventListener('click', () => {
                document.querySelectorAll('.filter-pill').forEach(p => p.classList.remove('active'));
                pill.classList.add('active');
                currentFilter = pill.dataset.filter;
                currentPage = 1;
                fetchSignals();
            });
        });

        document.getElementById('prevBtn').addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                fetchSignals();
            }
        });

        document.getElementById('nextBtn').addEventListener('click', () => {
            currentPage++;
            fetchSignals();
        });

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            updateTime();
            setInterval(updateTime, 1000);

            // External APIs
            fetchBinanceBTC();
            fetchBinanceFunding();
            fetchCoinGeckoGlobal();
            fetchFearGreed();

            // Refresh external APIs
            setInterval(fetchBinanceBTC, 5000);
            setInterval(fetchBinanceFunding, 60000);
            setInterval(fetchCoinGeckoGlobal, 120000);
            setInterval(fetchFearGreed, 300000);

            // Backend API
            fetchStats();
            fetchSignals();

            // Refresh backend data every 30 seconds
            setInterval(() => {
                fetchStats();
                fetchSignals();
            }, 30000);
        });
    </script>
</body>
</html>